\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ngse}[2022/02/08 NGSE Manuscript Style]

% --- Package Options: proposal and review ---
\RequirePackage{etoolbox}
\newtoggle{proposal}  % Proposal version
\newtoggle{review}  % Review version
\DeclareOption{proposal}{\toggletrue{proposal}}
\DeclareOption{review}{\toggletrue{review}}
\DeclareOption*{\PackageWarning{ngse}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax

% --- Language and encodings ---
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[english]{babel}

% --- Page size and margins ---
\RequirePackage[margin=1in,\iftoggle{proposal}{a4}{left=1.5in,letter}paper]{geometry}

% --- Indents and spacing ---
\setlength{\parindent}{0.5in}  % Half-inch indents
\RequirePackage{indentfirst}  % Indent the first paragraph of a section
\RequirePackage{setspace}  % Line spacing commands
\onehalfspacing  % 1.5 line spacing globally

% --- General style tweaks ---
\RequirePackage{newtxtext,newtxmath}  % Use Times Roman font
% Better typesetting with microtype
\RequirePackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=1100,stretch=10,shrink=10]{microtype}

% Combine chapter number and title in a single line
\RequirePackage{titlesec}
\titleformat{\chapter}[hang]{\normalfont\huge\bfseries}{\thechapter.}{1em}{}
\pagestyle{plain}  % No headers; page numbers at bottom-center of page

% --- ToC tweaks ---
\addto\captionsenglish{\renewcommand{\contentsname}{Table of Contents}}  % Rename ToC
\RequirePackage{tocbibind}  % Add the ToC and bibliography (BibTeX only) to the ToC
\RequirePackage[titletoc]{appendix}  % Provides `appendices` environment; `titletoc` adds appendices to ToC.

% --- Metadata ---
\input{metadata}
\title{\thesistitle}
\author{\student}
\date{\submissiondate}
\AtBeginDocument{
\hypersetup{pdftitle=\thesistitle}
\hypersetup{pdfauthor=\student}
\hypersetup{pdfkeywords=\keywords}
\hypersetup{pdfsubject=\degree}
}

% --- Prelim pages command ---
\newcommand{\makeprelimpages}{%
\iftoggle{proposal}{%
    {\singlespacing\input{prelim_pages/title_page_proposal}}
}{%
    {\singlespacing
    \input{prelim_pages/title_page}
    \input{prelim_pages/univ_permission_page}
    \input{prelim_pages/approval_page}
    }
    \input{prelim_pages/acknowledgment}
}
\input{prelim_pages/abstract}
{%
    \hypersetup{hidelinks}  % Hide links for these pages even for the review version
    \tableofcontents
    \listoftables
    \listoffigures
}
}

% --- Line numbers for review ---
\iftoggle{review}{
\RequirePackage{lineno}
\RequirePackage{color}
\renewcommand{\linenumberfont}{\normalfont\footnotesize\sffamily\color[rgb]{.5,.5,1}}  % blue font color, larger font
\setlength\linenumbersep{1cm}  % wider separation
% Line numbers in both margins (adapted from: https://tex.stackexchange.com/a/199593)
\makeatletter
\renewcommand\makeLineNumberLeft{%
    \linenumberfont
    \llap{\hss\LineNumber\hskip\linenumbersep}  % left margin
    \hskip\columnwidth\hskip\linenumbersep
    \rlap{\hb@xt@\linenumberwidth{\hss\LineNumber}\hss}  % right margin
}
\makeatother
\leftlinenumbers  % Re-issue [left] option
\linenumbers
}{}

% --- Abbreviations (extracted from CVPR template) ---
% Add a period to the end of an abbreviation unless there's one already, then \xspace.
\RequirePackage{xspace}
\makeatletter
\DeclareRobustCommand\onedot{\futurelet\@let@token\@onedot}
\def\@onedot{\ifx\@let@token.\else.\null\fi\xspace}

\def\eg{\emph{e.g}\onedot} \def\Eg{\emph{E.g}\onedot}
\def\ie{\emph{i.e}\onedot} \def\Ie{\emph{I.e}\onedot}
\def\cf{\emph{cf}\onedot} \def\Cf{\emph{Cf}\onedot}
\def\etc{\emph{etc}\onedot} \def\vs{\emph{vs}\onedot}
\def\wrt{w.r.t\onedot} \def\dof{d.o.f\onedot}
\def\iid{i.i.d\onedot} \def\wolog{w.l.o.g\onedot}
\def\etal{\emph{et al}\onedot}
\makeatother

\endinput
